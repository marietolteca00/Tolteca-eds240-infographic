---
title: "Finalizing Vizs"
format:
  html:
    fig-align: center
---
# Libraries
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(dplyr)
library(ggimage)
library(patchwork)
library(glue)
library(showtext)
library(ggtext)
library(ggpath)


#......................import Google fonts.......................
# `name` is the name of the font as it appears in Google Fonts
# `family` is the user-specified id that you'll use to apply a font in your ggplot

font.add.google(name = "Sarala", family = "sarala")

font.add.google(name = "Noto Sans", family = "noto-sans")

font.add.google(name = "Red Hat Mono", family = "red")

#....................import Font Awesome fonts...................
font_add(family = "fa-brands",
         regular = here::here("fonts","Font Awesome 7 Brands-Regular-400.otf"))
```

# Import Data
```{r, warning=FALSE,message=FALSE}
hero_kd_summary <- read.csv(here('data','hero_kd_summary.csv'))
role_stats <- read.csv(here('data','role_stats.csv'))
```


```{r, warning=FALSE}
#| fig-width: 10
#| fig-height: 8
#| out-width: "100%"
showtext.auto(enable = TRUE)

#..........................create title..........................

title <- glue::glue("<span style='color:#182C2C;'>Hero</span> 
                    <span style='color:#E60013;'>Comparison</span>")

#.........................create caption.........................

github_icon <- "\uf09b"
github_username <- "marietolteca00"

caption <- glue::glue(
  "Data Source: Â©2026 MARVEL <br>
  <span style='font-family:fa-brands;'>{github_icon}</span>
  {github_username}"
)

# Fix Heroes image URL in hero_kd_summary
hero_kd_summary <- hero_kd_summary %>%
  mutate(
    image_url = case_when(
      hero_name == "phoenix" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/40/img_phoenix.png",
      hero_name == "captain america" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/3/img_captain-america.png",
      hero_name == "moon knight" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/16/img_moon-knight.png",
      hero_name == "star-lord" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/24/img_star-lord.png",
      hero_name == "the punisher" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/20/img_icon_the-punisher.webp",
      hero_name == "winter soldier" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/28/img_winter-soldier.webp",
      hero_name == "jeff the land shark" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/10/img_jeff-the-land-shark.webp",
      hero_name == "venom" ~ "https://rivalskins.com/wp-content/uploads/marvel-assets/items/spray/27/img_venom.webp",

      TRUE ~ image_url
    )
  )

## Factor Re-Order!!!!!!

# Then recreate hero_polar with the fixed data
hero_polar <- hero_kd_summary %>%
  select(hero_name, avg_kills, avg_deaths, role, image_url) %>%
  pivot_longer(cols = c(avg_kills, avg_deaths), 
               names_to = "stat", 
               values_to = "value") %>%
  mutate(stat_label = ifelse(stat == "avg_kills", "Kills", "Deaths")) %>%
  mutate(hero_name = str_to_title(hero_name)) %>%
  group_by(hero_name) %>%
  mutate(
    pct = value / sum(value),
    y_pos = cumsum(pct) - 0.5 * pct
  )

# Plot
hero_polar %>%
  ggplot() +
  # Adding Images from website URL
  geom_from_path(
    data = hero_polar %>% distinct(hero_name, .keep_all = TRUE),
    aes(x = 0, y = 0, path = image_url),
    width = 0.50) +
  
  # Donut Hole plot
  geom_col(aes(x = 5, y = pct, fill = stat_label), width = 2, alpha = 0.8) +  # Change x from 3 to 4

  geom_text(aes(x = 5.2, y = y_pos, label = round(value, 1)),  # Adjust text position too
            size = 4, fontface = "bold") +
  
  facet_wrap(~hero_name, ncol = 4) +
  
  scale_fill_manual(values = c("Kills" = "#99381E", "Deaths" = "#4E5472")) +
  
  coord_polar("y") +
  
  xlim(0, 6) +  # Increase limit to accommodate new positions
  
  labs(fill = "",
       title = title,
       subtitle= "Kill to Death Comparison",
       caption = caption) +
  
  theme_void() +
  
  theme(
    plot.background = element_rect(fill = "lightgrey", color = "aliceblue", linewidth = 3),
    panel.background = element_rect(fill = "azure2"),
    
  strip.text = element_text(size = 12, face = "bold", margin = margin(b = 5)),
  
  legend.position = "bottom",
  
  legend.text = element_text(size = 15),
  
  plot.margin = margin(t = 0.5, r = 0.5, b = 0.5, l = 0.5, unit = "cm"),
  
  panel.spacing = unit(1.5, "lines"),
  
  plot.title = ggtext::element_markdown(
    family = "noto-sans",
    face = "bold",
    size = 20,
    hjust = 0.5,
    color = "#ACAB97",
    margin = margin(b = 10)),
  
  plot.subtitle = element_text(hjust = 0.5, margin = margin(b = 20)),
  
  plot.caption = ggtext::element_markdown(
    face = "italic",
    size = 8,
    margin = margin(t = 15),
    lineheight = 1.5)
  )
  
# Uncomment To Show Correctly

# Always turn off
#showtext.auto(enable = FALSE)

```
# Role Stats Finalizing
```{r}
# role_stats <- role_stats %>% 
#   mutate(
#     image_url = case_when(
#       role == "Duelist" ~ "https://pbs.twimg.com/media/GuypdJiWcAEZmFD.jpg",
#       TRUE ~ image_url
#     )
#   )
# Bar Chart - Win Rate by Roles
ggplot(role_stats, aes(x = role, y = win_rate)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = paste0(round(win_rate*100, 1), "%")), vjust = -0.5) +
  labs(x = "Role", y = "Win Rate", title = "Win Rate by Role")+
  geom_image(aes(image =))

```

